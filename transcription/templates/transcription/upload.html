{% extends "transcription/base.html" %}
{% load static %}
{% block title %}Upload{% endblock %}
{% block page_title %}Upload Interview{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-xl shadow-sm border p-6">

    <p class="text-slate-500 mb-6">
        Supported formats: <strong>MP3, WAV, M4A, AAC</strong><br>
        Maximum file size: 200MB<br>
        Maximum files per upload: 2
    </p>

    <!-- Drag-and-Drop Upload -->
    <form method="post" enctype="multipart/form-data" class="space-y-4" id="uploadForm">
        {% csrf_token %}
        <div id="dropZone"
             class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 transition">
            <p id="dropZoneText" class="text-gray-500">Drag & drop your audio here, or click to select a file</p>
            <input type="file" name="audio_file" id="fileInput" accept=".mp3,.wav,.m4a,.aac" class="hidden" multiple required>
        </div>

        <button type="submit"
                id="uploadBtn"
                class="w-full bg-indigo-600 text-white py-2.5 rounded-lg hover:bg-indigo-700 transition">
            Upload & Transcribe
        </button>
    </form>

    <!-- File info / error messages -->
    <p id="fileInfo" class="mt-2 text-sm text-gray-600"></p>
    <p id="fileError" class="mt-2 text-sm text-red-600"></p>

    <!-- Upload queue -->
    <div id="uploadQueue" class="mt-4 space-y-3 hidden"></div>

    <div class="mt-3 flex items-center gap-3">
        <button id="clearBtn" type="button" class="text-sm text-gray-600 hover:underline hidden">
            Clear selected file
        </button>
        <button id="cancelUploadBtn" type="button" class="text-sm text-red-600 hover:underline hidden">
            Cancel current upload
        </button>
    </div>

    <p id="uploadDoneNote" class="mt-3 text-sm text-green-700 hidden">
        Uploads complete. Redirecting to the Processing page...
    </p>

    <div id="previewWrap" class="mt-4 hidden">
        <p class="text-xs text-gray-500 mb-2">Preview (first file)</p>
        <audio id="previewAudio" controls class="w-full"></audio>
        <p id="previewDuration" class="text-xs text-gray-500 mt-1"></p>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmOverlay" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 p-6">
        <h3 id="confirmTitle" class="text-lg font-semibold text-gray-800 mb-2">Confirm</h3>
        <p id="confirmMessage" class="text-sm text-gray-600 mb-4">Are you sure?</p>
        <div class="flex justify-end gap-2">
            <button id="confirmCancel" type="button" class="px-4 py-2 rounded bg-gray-100 text-gray-700 hover:bg-gray-200">
                No
            </button>
            <button id="confirmOk" type="button" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">
                Yes
            </button>
        </div>
    </div>
</div>

<script src="{% static 'transcription/upload.js' %}"></script>
{% endblock %}
